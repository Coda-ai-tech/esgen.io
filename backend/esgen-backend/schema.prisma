// This file is automatically generated by Keystone, do not modify it manually.
// Modify your Keystone config when you want to change this.

datasource postgresql {
  url               = env("DATABASE_URL")
  shadowDatabaseUrl = env("SHADOW_DATABASE_URL")
  provider          = "postgresql"
}

generator client {
  provider = "prisma-client-js"
}

model User {
  id                 String    @id @default(cuid())
  name               String    @default("")
  email              String    @unique @default("")
  password           String
  companyName        String    @default("")
  jobTitle           String    @default("")
  phone              String    @default("")
  subscriptionStatus String?   @default("free")
  preferredLanguage  String?   @default("zh-TW")
  reports            Report[]  @relation("Report_author")
  payments           Payment[] @relation("Payment_user")
  createdAt          DateTime? @default(now())
  updatedAt          DateTime? @updatedAt
}

model Report {
  id              String    @id @default(cuid())
  title           String    @default("")
  status          String?   @default("draft")
  companyName     String    @default("")
  industry        String    @default("")
  companySize     String    @default("")
  location        String    @default("")
  description     String    @default("")
  frameworks      Json?     @default("[]")
  fiscalYear      String    @default("2024")
  materialTopics  Json?     @default("[]")
  scope1Emissions String    @default("")
  scope2Emissions String    @default("")
  scope3Emissions String    @default("")
  previewContent  String    @default("")
  fullContent     String    @default("")
  pdfUrl          String    @default("")
  paymentRequired Boolean   @default(true)
  paymentAmount   Float?    @default(299)
  author          User?     @relation("Report_author", fields: [authorId], references: [id])
  authorId        String?   @map("author")
  payment         Payment?  @relation("Payment_report")
  createdAt       DateTime? @default(now())
  updatedAt       DateTime? @updatedAt
  completedAt     DateTime?

  @@index([authorId])
}

model Payment {
  id                     String    @id @default(cuid())
  paymentId              String    @unique @default("")
  airwallexTransactionId String    @default("")
  amount                 Float
  currency               String    @default("HKD")
  status                 String?   @default("pending")
  paymentMethod          String    @default("")
  metadata               Json?     @default("{}")
  user                   User?     @relation("Payment_user", fields: [userId], references: [id])
  userId                 String?   @map("user")
  report                 Report?   @relation("Payment_report", fields: [reportId], references: [id])
  reportId               String?   @unique @map("report")
  createdAt              DateTime? @default(now())
  updatedAt              DateTime? @updatedAt
  paidAt                 DateTime?

  @@index([userId])
}
